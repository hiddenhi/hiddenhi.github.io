
<!DOCTYPE html>
<html>
<meta http-equiv="X-UA-Compatible" content="IE=10;IE=9;IE=8;" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Cache-Control" content="no-cache"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=0;"/>
<meta name="MobileOptimized" content="240"/><title>IFYUN水印</title>
    <head>
        <meta charset="UTF-8">
        <title></title>
        <style>
*{text-align:center;}*{
margin: 0;
}
            .test{
                text-align: center;
                display: inline-block;
                vertical-align:top;
            }
            canvas{
                margin-right: 5px;
            }
            .down{
                float: right;
                 margin: 40px 10px;
            }


 #dv {
	color:blue;
	position:absolute;
}

        #div1{
            height: 1000px;
        }
        #div2{
            position: absolute;
            top:0;
            left:0;
            height:100px;
            color:#1e87cc;
        }


        </style>
    </head>
    <body>





<script type="text/javascript">
window.onload = function(){ 
// 抓取上传图片，转换代码结果，显示图片的dom
var img_upload=document.getElementById("img_upload");

var img_area=document.getElementById("ximg");
// 添加功能出发监听事件
img_upload.addEventListener('change',readFile,false);}
function readFile(){
var file=this.files[0];
if(!/image\/\w+/.test(file.type)){ 
alert("请确保文件为图像类型"); 
return false; 
}
var reader=new FileReader();
reader.readAsDataURL(file);
reader.onload=function(){

fww.src=this.result;
}
}
</script>
<input type="file" id="img_upload"/>


<div class="test" >
<img id="fww" src="" style="width:99%;" >
<br>
<div id="div2"><img style="width:100px;" src="r.png"></div>
</div>


<br>
<button onclick="gg()">截图</button>
<br>
<button onclick="fg()">生成图片</button>
<br>
<img id="zuihou" src="" style="width:99%">
<br>

<script src="html2canvas.js"></script>




<script>
function gg(){
if(document.getElementById("font")){
document.body.removeChild(document.getElementById("font"));
zuihou.src="";
}else{

   
    var canvas2 = document.createElement("canvas");
    let _canvas = document.querySelector('div');
    var w = parseInt(window.getComputedStyle(_canvas).width);
    var h = parseInt(window.getComputedStyle(_canvas).height);
    canvas2.id="font";
    canvas2.width = w * 2;
    canvas2.height = h * 2;
    canvas2.style.width = w + "px";
    canvas2.style.height = h + "px";
    canvas2.style.display = "none";

    canvas2.crossOrigin="anonymous";
    var context = canvas2.getContext("2d");
    context.scale(2,2);
     html2canvas(document.querySelector('div'),{canvas:canvas2}).then(function(canvas) {
            document.body.appendChild(canvas);
     });
fg();
}
}
function fg(){
var canvass=document.getElementById("font");
var base64=canvass.toDataURL("png");
zuihou.src=base64;
}

</script>


<script>
    var flag = false;
    var cur = {
        x:0,
        y:0
    }
    var nx,ny,dx,dy,x,y ;
    function down(){
        flag = true;
        var touch ;
        if(event.touches){
            touch = event.touches[0];
        }else {
            touch = event;
        }
        cur.x = touch.clientX;
        cur.y = touch.clientY;
        dx = div2.offsetLeft;
        dy = div2.offsetTop;
    }
    function move(){
        if(flag){
            var touch ;
            if(event.touches){
                touch = event.touches[0];
            }else {
                touch = event;
            }
            nx = touch.clientX - cur.x;
            ny = touch.clientY - cur.y;
            x = dx+nx;
            y = dy+ny;
            div2.style.left = x+"px";
            div2.style.top = y +"px";
            //阻止页面的滑动默认事件
            document.addEventListener("touchmove",function(){
                event.preventDefault();
            },false);
        }
    }
    var div2 = document.getElementById("div2");
    div2.addEventListener("mousedown",function(){
        down();
    },false);
    div2.addEventListener("touchstart",function(){
        down();
    },false)
    div2.addEventListener("mousemove",function(){
        move();
    },false);
    div2.addEventListener("touchmove",function(){
        move();
    },false)
    document.body.addEventListener("mouseup",function(){
        flag = false;
    },false);
    div2.addEventListener("touchend",function(){
        flag = false;
    },false)
</script>

</body>
</html>