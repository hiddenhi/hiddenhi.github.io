<!DOCTYPE html>
<html>
<meta http-equiv="X-UA-Compatible" content="IE=10;IE=9;IE=8;" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Cache-Control" content="no-cache"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=0;"/>
<meta name="MobileOptimized" content="240"/><title>IFYUN水印</title>
    <head>
        <meta charset="UTF-8">
        <title></title>
        <style>
*{text-align:center;}*{
margin: 0;
}
            .test{
                text-align: center;
                display: inline-block;
                vertical-align:top;
            }
            canvas{
                margin-right: 5px;
            }
            .down{
                float: right;
                 margin: 40px 10px;
            }


 #dv {
	color:blue;
	position:absolute;
}
        </style>
    </head>
    <body>





<script type="text/javascript">
window.onload = function(){ 
// 抓取上传图片，转换代码结果，显示图片的dom
var img_upload=document.getElementById("img_upload");

var img_area=document.getElementById("ximg");
// 添加功能出发监听事件
img_upload.addEventListener('change',readFile,false);}
function readFile(){
var file=this.files[0];
if(!/image\/\w+/.test(file.type)){ 
alert("请确保文件为图像类型"); 
return false; 
}
var reader=new FileReader();
reader.readAsDataURL(file);
reader.onload=function(){

fww.src=this.result;
}
}
</script>
<input type="file" id="img_upload"/>
<script src="jquery.min.js"></script>
<div class="test">
<img id="fww" src="" style="width:99%">
<br>
<div id="dv">IFYUN水印</div>
</div>
<br>
<button onclick="gg()">截图</button>
<br>
<button onclick="fg()">生成图片</button>
<br>
<img id="zuihou" src="" style="width:99%">
<br>

<script src="html2canvas.js"></script>




<script>
function gg(){
if(document.getElementById("font")){
document.body.removeChild(document.getElementById("font"));
zuihou.src="";
}else{
    var canvas2 = document.createElement("canvas");
    let _canvas = document.querySelector('div');
    var w = parseInt(window.getComputedStyle(_canvas).width);
    var h = parseInt(window.getComputedStyle(_canvas).height);
    canvas2.id="font";
    canvas2.width = w * 2;
    canvas2.height = h * 2;
    canvas2.style.width = w + "px";
    canvas2.style.height = h + "px";
    canvas2.crossOrigin="anonymous";
    var context = canvas2.getContext("2d");
    context.scale(2,2);
     html2canvas(document.querySelector('div'),{canvas:canvas2}).then(function(canvas) {
            document.body.appendChild(canvas);
     });
}
}
function fg(){
var canvass=document.getElementById("font");
var base64=canvass.toDataURL("png");
zuihou.src=base64;
}

</script>

<script>
//获取元素
var dv = document.getElementById('dv');
var x = 0;
var y = 0;
var l = 0;
var t = 0;
var isDown = false;
//鼠标按下事件
dv.onmousedown = function(e) {
    //获取x坐标和y坐标
    x = e.clientX;
    y = e.clientY;

    //获取左部和顶部的偏移量
    l = dv.offsetLeft;
    t = dv.offsetTop;
    //开关打开
    isDown = true;
    //设置样式  
    dv.style.cursor = 'move';
}
//鼠标移动
window.onmousemove = function(e) {
    if (isDown == false) {
        return;
    }
    //获取x和y
    var nx = e.clientX;
    var ny = e.clientY;
    //计算移动后的左偏移量和顶部的偏移量
    var nl = nx - (x - l);
    var nt = ny - (y - t);
    dv.style.left = nl + 'px';
    dv.style.top = nt + 'px';
}
//鼠标抬起事件
dv.onmouseup = function() {
    //开关关闭
    isDown = false;
    dv.style.cursor = 'default';
}
</script>



</body>
</html>